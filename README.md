# NoH Benchmarks

This repository contains 4 benchmark designs used in the NoH evaluation. Each benchmark has four configurations.

| **Workload** | **FPGA** | **Memory** | **# Dice** | **Most-used** |
|--------------|----------|------------|------------|---------------|
| [MM](https://github.com/UCLA-VAST/AutoSA) | VPK180 | DRAM | 4 | DSP |
| [Jacobi3D](https://github.com/UCLA-VAST/soda) | VPK180 | DRAM | 4 | DSP |
| [KNN](https://github.com/SFU-HiAccel/CHIP-KNN) | VHK158 | HBM | 2 | LUT |
| [SpMV](https://github.com/UCLA-VAST/Serpens) | VHK158 | HBM | 2 | BRAM |

Each configuration has two versions of RTL folders. `RTL` is the default version generated by [TAPA](https://github.com/rapidstream-org/rapidstream-tapa). We also include `RTL-pipelined`, generated by [AutoBridge](https://github.com/UCLA-VAST/AutoBridge), which should achieve higher frequency.

AutoBridge creates a coarse-grained floorplan of the design to balance utilization and reduce congestion, and adds pipelining registers to long connections. `constraint.tcl` is the floorplan but the instance prefix (`top_arm_i/dut_0/`) needs to be changed according to the instance hierarchy in your project. 

> **Note:** AutoBridge is from 2021. We recommend interested users to try Rapidstream, the latest optimized version and free for academic use.

## Folder Structure of Each Benchmark

```
root
└── benchmark
    └── configuration
        ├── rtl
        ├── rtl_pipelined
        └── constraint.tcl
```

## Systolic-array Matrix-multiply (mm) Accelerators

Generated using [AutoSA](https://github.com/UCLA-VAST/AutoSA). The targeted device is `xcvp1802-lsvc4072-2MP-e-S` (VPK180 board). The target HLS frequency is 300 MHz. The top-level module is `kernel0`. We vary the systolic array width and height. The configurations include:
- 18x16
- 18x17
- 18x18
- 18x19

> **Note:** The pipelined versions all failed to route because AutoBridge could not handle these many nodes (>200). Its ILP-based algorithm could not converge in 7 hours so the resulting floorplan is sub-optimal with very high inter-die crossings.

### Example AutoSA Command

Change `array_part[0]` and `array_part[1]` to vary the width and height respectively:

```sh
./autosa ./autosa_tests/large/mm/kernel.c \
--config=./autosa_config/autosa_config.json \
--target=autosa_tapa \
--output-dir=./autosa.tmp/output \
--sa-sizes="{kernel[]->space_time[3];kernel[]->array_part[144,128,64];kernel[]->latency[8,8];kernel[]->simd[32]}" \
--data-pack-sizes="{kernel[]->cin[64,64,64];kernel[]->cout[64,64,64];kernel[]->w[64,64,64]}" \
--simd-info=./autosa_tests/large/mm/simd_info.json \
--host-serialize \
--hls
```




